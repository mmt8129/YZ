<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Y.Z</title>
    <style>
        /* TEMEL AYARLAR */
        :root {
            --bg-color: #ffffff;
            --text-color: #1a1a1a;
            --header-bg: #f8f9fa;
            --user-bubble: #007bff;
            --user-text: #ffffff;
            --bot-text: #1a1a1a;
            --accent-red: #ff4d4d;
            --font-size: 16px;
            --font-weight: 400;
        }

        .dark-theme {
            --bg-color: #000000;
            --text-color: #ffffff;
            --header-bg: #1a1a1a;
            --bot-text: #ffffff;
        }

        body {
            margin: 0; padding: 0;
			width: 100vw; /* EkranÄ±n tam geniÅŸliÄŸi */
			overflow-x: hidden; /* Yatay kaydÄ±rmayÄ± kesin olarak engeller */
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex; flex-direction: column;
            height: 100vh; overflow: hidden;
        }

        /* ÃœST BANNER */
        header {
            padding: 10px 15px;
            background: var(--header-bg);
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid var(--user-bubble);
        }

        .date-time { line-height: 1.2; }
        #time { font-size: 1.4rem; font-weight: 700; }
        #date { font-size: 0.85rem; opacity: 0.8; }

        .controls { display: flex; gap: 5px; }
        .controls button {
            border: 1px solid #ddd; background: white;
            border-radius: 8px; padding: 5px; cursor: pointer; font-size: 0.9rem;
        }

        /* MESAJ ALANI */
        #chat-container {
            flex: 1; overflow-y: auto; padding: 20px 0;
            display: flex; flex-direction: column; gap: 20px;
        }

        .message { max-width: 100%; padding: 10px 15px; font-size: var(--font-size); font-weight: var(--font-weight); line-height: 1.6; }
        
        /* Giden Mesaj: Mavi Balon */
        .user-msg {
            align-self: flex-end;
            background-color: var(--user-bubble);
            color: var(--user-text);
            border-radius: 18px 18px 0 18px;
            margin-right: 15px; max-width: 80%;
        }

        /* Gelen Mesaj: Ã‡erÃ§evesiz Tam GeniÅŸlik */
        .bot-msg {
            align-self: flex-start;
            background: transparent;
            color: var(--bot-text);
            width: 100%; margin: 0;
			padding: 15px; /* Okunabilirlik iÃ§in iÃ§ boÅŸluk */
			box-sizing: border-box; /* Padding dahil geniÅŸliÄŸi ayarlar, taÅŸmayÄ± Ã¶nler */
        }

        /* KÄ±rmÄ±zÄ± KalÄ±n YazÄ±lar */
        .bot-msg strong { color: #ff4d4d !important; /* CanlÄ± bir kÄ±rmÄ±zÄ± */
    font-weight: bold; display: inline-block; /* BoÅŸluklarÄ±n dÃ¼zgÃ¼n gÃ¶rÃ¼nmesi iÃ§in */ }

        /* BEKLEME ANÄ°MASYONU */
        .dots { display: flex; gap: 5px; padding: 10px 15px; }
        .dot { width: 10px; height: 10px; background: var(--user-bubble); border-radius: 50%; opacity: 0.3; animation: blink 1.4s infinite; }
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }
        /* ... 6 nokta iÃ§in devam eder ... */

        @keyframes blink { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }

        /* ALT GÄ°RÄ°Å Ã‡UBUÄU */
        footer {
            padding: 15px; background: var(--header-bg);
            display: flex; gap: 10px; align-items: center;
        }

        .input-box {
            flex: 1; border: 1px solid #ccc; border-radius: 25px;
            padding: 10px 15px; background: var(--bg-color); color: var(--text-color);
        }

        .file-btn { font-size: 1.5rem; color: var(--user-bubble); cursor: pointer; }
        .send-btn { background: var(--user-bubble); color: white; border: none; border-radius: 20px; padding: 10px 20px; font-weight: bold; }
    </style>
</head>
<body id="main-body">

    <header>
        <div class="date-time">
            <div id="time">10:30</div>
            <div id="date">20 Åubat Cuma</div>
        </div>
        <div class="controls">
            <button onclick="changeZoom(1)">ğŸ”+</button>
            <button onclick="changeZoom(-1)">ğŸ”-</button>
            <button onclick="toggleBold(true)">B+</button>
            <button onclick="toggleBold(false)">B-</button>
            <button onclick="setTheme('dark')">ğŸŒ‘</button>
            <button onclick="setTheme('light')">â˜€ï¸</button>
        </div>
    </header>

    <main id="chat-container">
        <div class="message user-msg">Selam, bugÃ¼n hava nasÄ±l?</div>
        <div class="message bot-msg">BugÃ¼n gÃ¶kyÃ¼zÃ¼ <strong>parÃ§alÄ± bulutlu</strong> ve sÄ±caklÄ±k 15 derece civarÄ±nda olacak.</div>
    </main>

    <div id="waiting" class="dots" style="display:none;">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>

    <footer>
        <label class="file-btn">+</label><button class="add-btn" onclick="document.getElementById('file-input').click()">+</button>
<input type="file" id="file-input" style="display: none;" accept="image/*" onchange="handleFileUpload(event)">
        <input type="text" class="input-box" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n...">
       <button class="send-btn" onclick="sendMessage()">GÃ¶nder</button>
    </footer>

    <script>
	let selectedFileData = null;
let selectedFileType = null;
let API_KEY = localStorage.getItem('gemini_api_key') || "";

// --- 1. SAAT FONKSÄ°YONU ---
function updateTime() {
    const now = new Date();
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    // EÄŸer HTML'de saatin id'si 'current-time' ise:
    const timeElement = document.getElementById('current-time');
    if (timeElement) timeElement.textContent = `${hours}:${minutes}`;
}
setInterval(updateTime, 1000);
updateTime();

// --- 2. DOSYA YÃœKLEME MANTIÄI ---
function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    selectedFileType = file.type;
    const reader = new FileReader();

    reader.onload = function(e) {
        const base64Data = e.target.result.split(',')[1];
        selectedFileData = base64Data;
        
        let previewHTML = file.type.startsWith('image/') 
            ? `<img src="${e.target.result}" style="max-width:150px; border-radius:10px; margin-top:5px;">`
            : `ğŸ“„ <strong>Dosya Eklendi:</strong> ${file.name}`;
        
        addMessage(previewHTML, 'user-msg');
    };

    if (file.type === "text/plain") {
        const textReader = new FileReader();
        textReader.onload = (e) => {
            const input = document.querySelector('.input-box');
            input.value += `\n[Dosya Ä°Ã§eriÄŸi]: ${e.target.result}`;
            addMessage(`ğŸ“‘ Metin dosyasÄ± okundu: ${file.name}`, 'user-msg');
        };
        textReader.readAsText(file);
    } else {
        reader.readAsDataURL(file);
    }
}

// --- 3. MESAJ GÃ–NDERME ---
async function sendMessage() {
    const input = document.querySelector('.input-box');
    const messageText = input.value.trim();
    
    if (messageText === "" && !selectedFileData) return;

    if (messageText !== "") addMessage(messageText, 'user-msg');
    input.value = "";

    // Anahtar yoksa ilk mesajÄ± anahtar olarak kabul et
    if (!API_KEY || API_KEY === "") {
        API_KEY = messageText;
        localStorage.setItem('gemini_api_key', API_KEY);
        typeWriterEffect("ğŸ”‘ Anahtar kaydedildi! SayfayÄ± yenilemenize gerek yok, artÄ±k yazÄ±ÅŸabiliriz.");
        return;
    }

    showLoading(true);

    try {
        const parts = [];
        if (messageText !== "") parts.push({ text: messageText });
        else if (selectedFileData) parts.push({ text: "Bu dosyayÄ± analiz et." });

        if (selectedFileData) {
            parts.push({
                inline_data: {
                    mime_type: selectedFileType,
                    data: selectedFileData
                }
            });
        }

        // Dinamik URL: AnahtarÄ± her zaman gÃ¼ncel halinden alÄ±r
const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ contents: [{ parts: parts }] })
        });

        const data = await response.json();

        if (data.candidates && data.candidates[0]) {
            const botResponse = data.candidates[0].content.parts[0].text;
            showLoading(false);
            typeWriterEffect(botResponse);
        } else {
            throw new Error(data.error?.message || "Cevap alÄ±namadÄ±.");
        }
    } catch (error) {
        showLoading(false);
        addMessage("âš ï¸ Hata: " + error.message, 'bot-msg');
    } finally {
        selectedFileData = null;
        selectedFileType = null;
        const fileInput = document.getElementById('file-input');
        if (fileInput) fileInput.value = "";
    }
}

// --- 4. YARDIMCI FONKSÄ°YONLAR (Eksik olmasÄ±n) ---
function addMessage(text, className) {
    const chatContainer = document.getElementById('chat-container');
    const msgDiv = document.createElement('div');
    msgDiv.className = `message ${className}`;
    msgDiv.innerHTML = text;
    chatContainer.appendChild(msgDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

function showLoading(show) {
    let loader = document.getElementById('loader');
    if (show) {
        if (!loader) {
            loader = document.createElement('div');
            loader.id = 'loader';
            loader.className = 'message bot-msg';
            loader.innerHTML = '<span class="dot">.</span><span class="dot">.</span><span class="dot">.</span>';
            document.getElementById('chat-container').appendChild(loader);
        }
    } else if (loader) {
        loader.remove();
    }
}

function typeWriterEffect(text) {
    const chatContainer = document.getElementById('chat-container');
    const msgDiv = document.createElement('div');
    msgDiv.className = 'message bot-msg';
    chatContainer.appendChild(msgDiv);

    const words = text.split(' ');
    let i = 0;

    const interval = setInterval(() => {
        if (i < words.length) {
            let word = words[i];
            
            // YILDIZ KONTROLÃœ: Kelime iÃ§inde herhangi bir yerde ** var mÄ±?
            if (word.includes('**')) {
                // TÃ¼m yÄ±ldÄ±zlarÄ± temizle ve kÄ±rmÄ±zÄ± yap
                let cleanText = word.replace(/\*\*/g, '');
                word = `<strong style="color: #ff4d4d; font-weight: bold;">${cleanText}</strong>`;
            }

            msgDiv.innerHTML += word + ' '; // Her kelimeden sonra boÅŸluk ekle
            chatContainer.scrollTop = chatContainer.scrollHeight;
            i++;
        } else {
            clearInterval(interval);
        }
    }, 50); // Ä°deal hÄ±z
}

// Ekrana yeni mesaj balonu ekleyen yardÄ±mcÄ± fonksiyon
function addMessage(text, className) {
    const chatContainer = document.getElementById('chat-container');
    const msgDiv = document.createElement('div');
    msgDiv.className = `message ${className}`;
    msgDiv.innerHTML = text; // HTML desteÄŸi iÃ§in (KalÄ±n/KÄ±rmÄ±zÄ± yazÄ±lar iÃ§in)
    
    chatContainer.appendChild(msgDiv);
    
    // Her mesaj eklendiÄŸinde en aÅŸaÄŸÄ± kaydÄ±r
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

// YÃ¼kleme animasyonunu aÃ§/kapat
function showLoading(isVisible) {
    const loading = document.getElementById('waiting');
    loading.style.display = isVisible ? 'flex' : 'none';
    if (isVisible) {
        loading.scrollIntoView();
    }
}
	// Global deÄŸiÅŸkenler: AyarlarÄ±n durumunu saklar
let currentFontSize = 16;
let isBold = false;

// YazÄ± Boyutu DeÄŸiÅŸtirme (Y+ / Y-)
function changeZoom(step) {
    currentFontSize += (step * 2); // Her basÄ±ÅŸta 2 birim bÃ¼yÃ¼t/kÃ¼Ã§Ã¼lt
    if (currentFontSize < 12) currentFontSize = 12; // Ã‡ok kÃ¼Ã§Ã¼lmesini engelle
    if (currentFontSize > 30) currentFontSize = 30; // Ã‡ok bÃ¼yÃ¼mesini engelle
    
    // Mesaj alanÄ±ndaki tÃ¼m yazÄ±larÄ±n boyutunu gÃ¼ncelle
    document.getElementById('chat-container').style.setProperty('--font-size', currentFontSize + 'px');
}

// YazÄ± KalÄ±nlÄ±ÄŸÄ± DeÄŸiÅŸtirme (B+ / B-)
function toggleBold(status) {
    isBold = status;
    const weight = isBold ? '700' : '400';
    document.getElementById('chat-container').style.setProperty('--font-weight', weight);
}

// Tema DeÄŸiÅŸtirme (ğŸŒ‘ / â˜€ï¸)
function setTheme(mode) {
    const body = document.getElementById('main-body');
    if (mode === 'dark') {
        body.classList.add('dark-theme');
    } else {
        body.classList.remove('dark-theme');
    }
}
	function updateDateTime() {
    const now = new Date();
    
    // Saati formatla (Ã–rn: 14:05)
    const timeString = now.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
    
    // Tarihi formatla (Ã–rn: 20 Åubat Cuma)
    const options = { day: 'numeric', month: 'long', weekday: 'long' };
    const dateString = now.toLocaleDateString('tr-TR', options);
    
    document.getElementById('time').textContent = timeString;
    document.getElementById('date').textContent = dateString;
}

// Her saniye gÃ¼ncelle
setInterval(updateDateTime, 1000);
updateDateTime(); // Sayfa aÃ§Ä±lÄ±nca hemen Ã§alÄ±ÅŸtÄ±r
        // Tema ve Font FonksiyonlarÄ± buraya gelecek
        function setTheme(mode) {
            document.getElementById('main-body').className = (mode === 'dark' ? 'dark-theme' : '');
        }
        // DiÄŸer butonlar iÃ§in JavaScript'i bir sonraki adÄ±mda yazacaÄŸÄ±z.
		
		window.onload = checkApiKey;
		function checkApiKey() {
    const savedKey = localStorage.getItem('gemini_api_key');
    
    if (!savedKey) {
        // EÄŸer anahtar yoksa, kullanÄ±cÄ±ya ne yapmasÄ± gerektiÄŸini sÃ¶yleyen bir bot mesajÄ± gÃ¶nder
        addMessage("ğŸ¤– Merhaba! HenÃ¼z bir API anahtarÄ± tanÄ±mlanmamÄ±ÅŸ. LÃ¼tfen sohbeti baÅŸlatmak iÃ§in Gemini API anahtarÄ±nÄ± mesaj kutusuna yazÄ±p gÃ¶nderir misin? ğŸ”‘", 'bot-msg');
    } else {
        // EÄŸer anahtar varsa, normal bir selamlama yapabilir
        addMessage("ğŸ¤– HazÄ±rÄ±m! BugÃ¼n sana nasÄ±l yardÄ±mcÄ± olabilirim?", 'bot-msg');
    }
}
    </script>
</body>
</html>
